<?xml version="1.0" encoding="utf-8"?>
<s:Module xmlns:fx="http://ns.adobe.com/mxml/2009"
		  xmlns:s="library://ns.adobe.com/flex/spark"
		  xmlns:mx="library://ns.adobe.com/flex/mx"
		  xmlns:services="services.*"
		  width="1000" creationComplete="module1_creationCompleteHandler(event)">
	<fx:Style>
		@namespace s "library://ns.adobe.com/flex/spark";
		@namespace mx "library://ns.adobe.com/flex/mx";
		@namespace flexpad "com.flexpad.*";
		global
		{
			/*	chromeColor: #474747;
			color: #D6D6D6;
			contentBackgroundColor: #000000;
			symbolColor: #000000;*/
			rollOverColor: #FFFFFF;
			selectionColor: #FFFFFF;
			focusColor: #037EA7;
			accentColor: #037EA7;
			
			/*fontFamily : "Droid";*/
			fontFamily : "Malgun Gothic","Dotum","Gulim",AppleGothic,sans-serif;
			fontSize : 12px;
		}
		
		s|Scroller {
			skinClass : ClassReference("skin.scroller.ThinScrooller");
		}
		
	</fx:Style>
	<fx:Script>
		<![CDATA[
			import com.adobe.serialization.json.JSON;
			
			import lib.RemoteSingleManager;
			import lib.SLibrary;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.events.CollectionEvent;
			import mx.events.FlexEvent;
			import mx.rpc.events.ResultEvent;
			
			import spark.events.IndexChangeEvent;
			
			import valueObjects.BooleanAndDescriptionVO;
			import valueObjects.UrlDataVO;

			[Bindable]
			private var ac:ArrayCollection = null;
			
			[Bindable]
			private var acTemplet:ArrayCollection = null;
			
			
			private var jstr:String = "[[{\"type\":6,\"value\":\"\"},{\"type\":5,\"value\":{\"a\":{\"type\":0,\"value\":[\"정답1입니다.\",\"정답2입니다.\"]},\"q\":\"질문입니다.\"}},{\"type\":4,\"value\":{\"cnt\":10,\"passwd\":\"1234x\"}},{\"type\":3,\"value\":{\"next\":{\"type\":0,\"value\":\"\"},\"btnText\":\"확인\"}},{\"type\":2,\"value\":{\"commitMsg\":\"감사용\",\"btnText\":\"확인\",\"next\":0,\"layout\":\"one\"}},{\"type\":1,\"value\":{\"imgs\":[{\"link\":\"\",\"url\":\"/images/ic_launcher_smsmms.png\"},{\"link\":\"\",\"url\":\"/images/ic_launcher_smsmms.png\"}],\"layout\":\"tile\"}},{\"type\":0,\"value\":{\"text\":\"<p style='text-align:left'>안녕하세요!!!</p><p style='text-align:left'><b>박사준</b>입니다.</p>\"}}],[{\"type\":1,\"value\":{\"imgs\":[{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"},{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"},{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"},{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"},{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"}],\"layout\":\"tile\"}}],[{\"type\":1,\"value\":{\"imgs\":[{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"},\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"},{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"},{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"},{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"}],\"layout\":\"tile\"}}]],\"sort\":null,\"list\":{\"length\":3,\"source\":[[{\"type\":6,\"value\":\"\"},{\"type\":5,\"value\":{\"a\":{\"type\":0,\"value\":[\"정답1입니다.\",\"정답2입니다.\"]},\"q\":\"질문입니다.\"}},{\"type\":4,\"value\":{\"cnt\":10,\"passwd\":\"1234x\"}},{\"type\":3,\"value\":{\"next\":{\"type\":0,\"value\":\"\"},\"btnText\":\"확인\"}},{\"type\":2,\"value\":{\"commitMsg\":\"감사용\",\"btnText\":\"확인\",\"next\":0,\"layout\":\"one\"}},{\"type\":1,\"value\":{\"imgs\":[{\"link\":\"\",\"url\":\"/images/ic_launcher_smsmms.png\"},{\"link\":\"\",\"url\":\"/images/ic_launcher_smsmms.png\"}],\"layout\":\"tile\"}},{\"type\":0,\"value\":{\"text\":\"<p style='text-align:left'>안녕하세요!!!</p><p style='text-align:left'><b>박사준</b>입니다.</p>\"}}],[{\"type\":1,\"value\":{\"imgs\":[{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"},{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"},{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"},{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"},{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"}],\"layout\":\"tile\"}}],[{\"type\":1,\"value\":{\"imgs\":[{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"},{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"},{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"},{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"},{\"link\":\"\",\"url\":\"/images/icon_text_event.gif\"}],\"layout\":\"tile\"}}]]";
			
			/* arrayCollection to json
			first decode  the loaded json string: 
			var data:*  =JSON.decode(myJSON); 
			var myArrayCollection:ArrayCollection = new ArrayCollection 
				(data.stuffs);
			
			import com.adobe.serializers.json.JSONDecoder;
			var j:JSONDecoder= new JSONDecoder();   
			var obj:Object= j.decode(json string);
			myarray= obj as ArrayCollection;
			*/
			/**
			 * text : {type:0,value:{text:"<p style=\"text-align:left\">안녕하세요!!!</p><p style=\"text-align:left\"><b>박사준</b>입니다.</p>"}}
			 * image : {type:1,value:{layout:"tile", imgs:[{url:"/images/ic_launcher_smsmms.png",link:""},{url:"/images/ic_launcher_smsmms.png",link:""}]}}
			 * input : {type:2, value:{layout:"one",next:0,btnText:"확인",commitMsg:"감사용"}}
			 * button : {type:3, value:{next:{type:0,value:""},btnText:"확인"}}
			 * mileage : {type:4, value:{cnt:10,passwd:"1234x"}}
			 * asklist : {type:5, value:{q:"질문입니다.",a:{type:0,value:["정답1입니다.","정답2입니다."]}}}
			 * coupon : {type:6, value:""}
			 * */
			
			protected function module1_creationCompleteHandler(event:FlexEvent):void
			{
				// default {type:0, value:{}}
				/* ac = new ArrayCollection([
											[{type:6, value:""},{type:5, value:{q:"질문입니다.",a:{type:0,value:["정답1입니다.","정답2입니다."]}}},{type:4, value:{cnt:10,passwd:"1234x"}},{type:3, value:{next:{type:0,value:""},btnText:"확인"}},{type:2, value:{layout:"one",next:0,btnText:"확인",commitMsg:"감사용"}},{type:1,value:{layout:"tile", imgs:[{url:"/images/ic_launcher_smsmms.png",link:""},{url:"/images/ic_launcher_smsmms.png",link:""}]}},{type:0,value:{text:"<p style=\"text-align:left\">안녕하세요!!!</p><p style=\"text-align:left\"><b>박사준</b>입니다.</p>"}}],
											[{type:1,value:{layout:"tile", imgs:[{url:"/images/icon_text_event.gif",link:""},{url:"/images/icon_text_event.gif",link:""},{url:"/images/icon_text_event.gif",link:""},{url:"/images/icon_text_event.gif",link:""},{url:"/images/icon_text_event.gif",link:""}]}}],
											[{type:1,value:{layout:"tile", imgs:[{url:"/images/icon_text_event.gif",link:""},{url:"/images/icon_text_event.gif",link:""},{url:"/images/icon_text_event.gif",link:""},{url:"/images/icon_text_event.gif",link:""},{url:"/images/icon_text_event.gif",link:""}]}}]
										 ]); */
				
				//ac = new ArrayCollection(com.adobe.serialization.json.JSON.decode( jstr ) as Array);
				
				if (ac == null) {
					ac = new ArrayCollection();
					ac.addEventListener(CollectionEvent.COLLECTION_CHANGE, ac_changeHandler);
				}
				
				
				acTemplet = new ArrayCollection([
					{icon:"/images/ic_launcher_smsmms.png", label:"[빈페이지]\n내용 없는 빈페이지"},
					{icon:"/images/ic_launcher_smsmms.png", label:"[홍보]\n이미지와 텍스트"},
					{icon:"/images/ic_launcher_smsmms.png", label:"[이벤트&쿠폰]\n이벤트 및\n바코드 쿠폰"},
					{icon:"/images/ic_launcher_smsmms.png", label:"[마일리지]\n마일리지 적립\n및 사용"},
					{icon:"/images/ic_launcher_smsmms.png", label:"[설문조사]\n질문\n및 접속자 답"}
				]);
			}
			
			private function ac_changeHandler(event:CollectionEvent):void {
				noPage.visible = ac.length > 0 ? false:true;
			}
			
			protected function templets_changeHandler(event:IndexChangeEvent):void
			{
				var idx:int = event.newIndex;
				ac.addItem( getPageData(idx) );
			}
			
			private function getPageData(idx:int):Array {
				
				var rslt:Array = null;
				switch(idx)
				{
					case 0:{rslt = [];break;}
					case 1:{rslt = [{type:1,value:{layout:"horizontal", imgs:[{url:"/images/ic_launcher_smsmms.png",link:""},{url:"/images/ic_launcher_smsmms.png",link:""}]}}, {type:0,value:{text:"<p style=\"text-align:left\">안녕하세요!!!</p><p style=\"text-align:left\"><b>박사준</b>입니다.</p>"}}];break;}
					case 2:{rslt = [{type:1,value:{layout:"vertical", imgs:[{url:"/images/ic_launcher_smsmms.png",link:""}]}},{type:6, value:""}];break;}
					case 3:{rslt = [{type:1,value:{layout:"vertical", imgs:[{url:"/images/ic_launcher_smsmms.png",link:""}]}},{type:4, value:{cnt:10,passwd:"1234x"}}];break;}
					case 4:{rslt = [{type:1,value:{layout:"vertical", imgs:[{url:"/images/ic_launcher_smsmms.png",link:""}]}},{type:5, value:{q:"질문입니다.",a:{type:0,value:["정답1입니다.","정답2입니다."]}}}];break;}
					default:
					{
						rslt = [{type:1,value:{layout:"tile", imgs:[{url:"/images/ic_launcher_smsmms.png",link:""},{url:"/images/ic_launcher_smsmms.png",link:""}]}}];
						break;
					}
				}
				callLater(deSelectTemplete);
				return rslt;
			}
			private function deSelectTemplete():void {
				templets.selectedIndex = -1;
			}
			
			protected function complete_clickHandler(event:MouseEvent):void
			{
				var at:ArrayCollection = (mobileWebPages.dataProvider as ArrayCollection);
				var json:String = com.adobe.serialization.json.JSON.encode( at as Object );
				var urlvo:UrlDataVO = new UrlDataVO();
				urlvo.dt = json;
				urlvo.stopYN = "N";
				
				setUrlData(0, urlvo );
				
				//mobileWebPages.dataProvider = new ArrayCollection( (com.adobe.serialization.json.JSON.decode( com.adobe.serialization.json.JSON.encode(at as Object)) as Object).source as Array );
				//trace(com.adobe.serialization.json.JSON.encode(at as Object));
			}
			
			protected function setUrlDataResult_resultHandler(event:ResultEvent):void
			{
				var bvo:BooleanAndDescriptionVO = event.result as BooleanAndDescriptionVO;
				if (bvo != null) {
					if (bvo.bResult == true) {
						SLibrary.alert("적용 되었습니다.");
						MobileWebEditorAble(parentDocument.hostComponent).setUrl(int(bvo.strDescription));
						close_clickHandler(null);
					}
					else SLibrary.alert("실패 하였습니다."+bvo.strDescription);
				}
				
			} 
			
			// 0: insert , 1: update, 2: delete
			protected function setUrlData(arg0:int, arg1:UrlDataVO):void { setUrlDataResult.token = smt.setUrlData(arg0, arg1); }
			
			protected function close_clickHandler(event:MouseEvent):void { MobileWebEditorAble(parentDocument.hostComponent).removeModuleUrl(); }
			
		]]>
	</fx:Script>
	<fx:Declarations>
		<s:CallResponder id="setUrlDataResult" result="setUrlDataResult_resultHandler(event)"/>
		<services:Smt id="smt"
					  fault="Alert.show(event.fault.faultString + '\n' + event.fault.faultDetail)"
					  showBusyCursor="true"/>
		
	</fx:Declarations>
	
	<s:BitmapImage left="0" right="0" top="0" bottom="0"
				   source="@Embed('/skin/ics/assets/widget_dark.png', scaleGridTop='10', scaleGridBottom='320', scaleGridLeft='10', scaleGridRight='314')"
				   fillMode="scale" alpha="1"/>
	
	<s:VGroup left="7.2" right="7.2" top="10" bottom="8.08" horizontalAlign="center" gap="0">
		<s:Group width="100%">
			<s:Label text="모바일웹에디터" left="15" verticalCenter="-2" fontSize="16" fontWeight="bold" color="#FFFFFF" />
			<s:Image id="close" right="10" verticalCenter="-2" source="/skin/ics/assets/dark/icon/1-navigation-cancel.png" buttonMode="true" click="close_clickHandler(event)" />	
		</s:Group>
		<s:Rect width="100%" top="10" left="8" right="8"><s:stroke><s:SolidColorStroke color="#33B5E5" weight="2" /></s:stroke></s:Rect>
		<s:HGroup width="100%" height="610" gap="0">
			<s:Group width="20%" height="100%">
				<s:Rect width="100%" height="100%"><s:fill><s:SolidColor color="#999999" /></s:fill></s:Rect>
				<s:Group left="0" right="0" top="5" height="30">
					<s:Rect width="100%" height="100%"><s:fill><s:SolidColor color="#333333" /></s:fill></s:Rect>
					<s:Label text="페이지 추가" left="15" verticalCenter="0" color="#FFFFFF" />
				</s:Group>
				<s:List id="templets" width="100%" top="35" dataProvider="{acTemplet}" borderVisible="false" contentBackgroundAlpha="0" itemRenderer="module.url.TempletsRenderer"
						change="templets_changeHandler(event)">
				</s:List>
			</s:Group>
			<s:List id="mobileWebPages" width="80%" dataProvider="{ac}" borderVisible="false" contentBackgroundAlpha="0" itemRenderer="module.url.MobileWebPagesRenderer">
				<s:layout><s:HorizontalLayout horizontalAlign="center" paddingLeft="10" paddingRight="10" paddingTop="20" paddingBottom="10" gap="5" /></s:layout>
			</s:List>
		</s:HGroup>
	</s:VGroup>
	<s:HGroup id="noPage" verticalCenter="0" verticalAlign="middle" left="400">
		<s:Image source="/images/ic_launcher_smsmms.png" />
		<s:Label text="왼쪽 리스트에서 페이지를 추가 하세요." fontSize="20" fontWeight="bold" color="#FFFFFF" />
	</s:HGroup>
	
	<s:HGroup left="525" bottom="20">
		<s:Button id="preview" label="미리 보기" right="5" skinClass="module.url.component.skin.ButtonGray" color="#FFFFFF" />
		<s:Button id="complete" label="제작 완료" right="5" skinClass="module.url.component.skin.ButtonBlue" color="#FFFFFF" click="complete_clickHandler(event)" />
	</s:HGroup>
	
</s:Module>
