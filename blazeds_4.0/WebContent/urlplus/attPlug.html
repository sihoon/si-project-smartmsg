<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7"/>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="Content-Script-Type" content="text/javascript" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<title>URLPlus</title>
    <link rel="stylesheet" type="text/css" href="css/base.css" />
    <link rel="stylesheet" type="text/css" href="css/att.css" />
    <link rel="stylesheet" type="text/css" href="css/uploadify.css" />
	<link rel="stylesheet" type="text/css" href="css/jquery-ui-1.9.1.custom.min.css" />
    <script type="text/javascript" src="js/jquery-1.8.1.min.js"></script>
	<script type="text/javascript" src="js/jquery.uploadify-3.1.min.js"></script>
	<script type="text/javascript" src="js/jquery-ui-1.9.1.custom.min.js"></script>
    <script type="text/javascript" src="js/galleria/galleria-1.2.8.js"></script>
    <script type="text/javascript" src="js/jquery-urlplus-1.0.js"></script>
    <script type="text/javascript" src="js/masonry/jquery.masonry.min.js"></script>
   </head>
  <body>

	<script type="text/javascript">
    $(document).ready(function(){
        
        var thumbData = []; // thumb data

        $('#imgOne_upload').uploadify( uplodify_one('uploadify.jsp', 'imgOne', '') );//#imgOne_upload

		$('#imgThumbnail_upload').uploadify( uplodify_thumb("imgThumbnail_box") );//#imgThumbnail_upload

        $('#imgSlide_upload').uploadify( uplodify_slide('imgSlide_box') );//#imgSlide_upload
		
		addImageLayout('imgLayout', 6);

		$('#movieOne_upload').uploadify( uplodify_one('uploadify.jsp', 'movieOne', '') );//#movieOne_upload

		$('#movieSlide_upload').uploadify( uplodify_slide('movieSlide_box') );//#movieSlide_upload
        
    }) // $(document).ready

// ------------ thumb ---------------
    var start_pos = 0;
    var end_pos = 0;
    function thumbSortAble(b) {
        if (b) {
            $('#imgThumbnail_box').sortable({
                cursor: "move",
                start: function(event, ui) {
                    var sp = ui.item.index();
                    ui.item.data('start_pos', sp);
                },
                change: function(event, ui) {
                    start_pos = ui.item.data('start_pos');
                    end_pos = ui.placeholder.index();
                   
                    if (start_pos < end_pos) end_pos -= 1;
                     de(start_pos+"=>"+end_pos);

                },
                update: function(event, ui) {
                    de("end!! : "+start_pos+"=>"+end_pos);
                     $("#imgThumbnail_box").thumbNail("thumbSort", start_pos, end_pos);
                }
            });

            $("#imgThumbnail_box").disableSelection();

            $('#imgThumbnail_box > li > img.imgdel').hide();
            alert("이미지를 드래그 하여 순서를 변경하세요.");
        } else {
            $("#imgThumbnail_box").sortable( "destroy" );
            $("#imgThumbnail_box").thumbNail("reload");
            $('#imgThumbnail_box > li > img.imgdel').show();
            alert("이동모드가 해제 되었습니다.");
        }
    }



// ------------ slide ---------------
    /**
    * slide all remove click handler
    */
    function slideDataRemoveAll(ele) {
        $('#'+ele).slide('RemoveAllData');
        $('#'+ele).hide();
    }
    /**
    * slide drag & drop enable
    */
    var start_slide_pos = 0;
    var end_slide_pos = 0;
	function slideSortAble(b, ele) {
        if (b) {
            $('#'+ele+'_box').hide();
            $('#'+ele+'_move_box').show();

            slideMoveView(ele);

            $('#'+ele+'_move_box').sortable({
                cursor: "move",
                start: function(event, ui) {
                    var sp = ui.item.index();
                    ui.item.data('start_pos', sp);
                },
                change: function(event, ui) {
                    start_slide_pos = ui.item.data('start_pos');
                    end_slide_pos = ui.placeholder.index();
                   
                    if (start_slide_pos < end_slide_pos) end_slide_pos -= 1;
                     de(start_slide_pos+"=>"+end_slide_pos);

                },
                update: function(event, ui) {
                    de("end!! : "+start_slide_pos+"=>"+end_slide_pos);
                    $('#'+ele+'_box').slide("slideSort", start_slide_pos, end_slide_pos);
                }
            });
            $('#imgSlide_move_box').disableSelection();
            alert("이미지를 드래그 하여 순서를 변경하세요.");

        } else {
            $('#'+ele+'_move_box').sortable( "destroy" );
            $('#'+ele+'_move_box').hide();

            $('#'+ele+'_box').show();
            $('#'+ele+'_box').slide("load");
            alert("이동모드가 해제 되었습니다.");
        }
    }

    function slideMoveView(ele) {

        $('#'+ele+'_move_box').empty();
        var html = "";
        var sldata = $("#'+ele+'_box").slide("getData");

        var cnt = sldata.length;
        var obj = null;
        for ( var i = 0; i < cnt ; i++ ) {
            obj = sldata[i];
            html += '<li><img src="'+obj.thumb+'" /></li>';
        }
        $('#'+ele+'_move_box').html(html);
    }

//------------------ image layout ----------------------

function addImageLayout(ele, cnt) {
	var t = $('#'+ele);
	var html = "";
	for (var i = 0; i < cnt; i++){
		html += "<li class=\"layout-card\"><img id=\"il"+(i+1)+"\" src=\"\" /><div class=\"edite\"><img src=\"_images/img_del.gif\" width=\"18\" height=\"18\" /><div class=\"label\">"+(i+1)+"</div></div></li>";
	}
	t.html(html);
	initImageLayout(ele);
	addimageLayoutDelEvent(ele);
}
function addImageLayoutAppend(ele, cnt) {

	var t = $('#'+ele);
	var html = "";
	var ccnt = t.children().length;

	for (var i = ccnt; i < cnt+ccnt; i++){
		html += "<li class=\"layout-card\"><img id=\"il"+(i+1)+"\" src=\"\" /><div class=\"edite\"><img src=\"_images/img_del.gif\" width=\"18\" height=\"18\" /><div class=\"label\">"+(i+1)+"</div></div></li>";
	}
	t.append(html);

	reloadImageLayout(ele);
}

function addimageLayoutDelEvent(ele) {
	$( "#"+ele+" > li > .edite > img" ).click(function(){
            var idx = $(this).parent().parent().remove();
			reloadImageLayout(ele);
        });
}

function initImageLayout(ele) {

	var t = $('#'+ele);
    var maxWidth = t.width()-4;
    t.masonry({
        itemSelector:        '.layout-card',
        isResizable:        true,
        columnWidth: 1
    });
    
    t.sortable({
        distance: 12,
        forcePlaceholderSize: true,
        /*items: '.layout-card',*/
        placeholder: 'card-sortable-placeholder layout-card',
        tolerance: 'pointer',
        
        start:  function(event, ui) {
            ui.item.addClass('dragging').removeClass('layout-card');
            if ( ui.item.hasClass('bigun') ) {
                 ui.placeholder.addClass('bigun');
                 }
				
                 ui.item.parent().masonry('reload')
                },
        change: function(event, ui) {
                   ui.item.parent().masonry('reload');
                },
        stop:   function(event, ui) { 
                   ui.item.removeClass('dragging').addClass('layout-card');
                   ui.item.parent().masonry('reload');
				   reloadImageLayout(ele)
        }
   });

   t.children('li').each(function(){
		$(this).resizable({
			resize: function(event, ui) {
				ui.element.parent().masonry('reload');
			},
			stop: function(event, ui) {
			},
			minWidth: 8,
			minHeight: 8,
			maxWidth: maxWidth,
			grid: [1,1],
			handles: 'e,se,s'
		}).disableSelection();
	});

	initImageLayoutSelect();
}


function reloadImageLayout(ele) {
	var t = $('#'+ele);
    var maxWidth = t.width()-4;
	t.sortable('refresh');
	t.masonry('reload');

	t.children('li').each(function(){
		$(this).resizable();
		$(this).resizable('destroy').resizable({
			resize: function(event, ui) {
				ui.element.parent().masonry('reload');
			},
			stop: function(event, ui) {
			},
			minWidth: 8,
			minHeight: 8,
			maxWidth: maxWidth,
			grid: [1,1],
			handles: 'e,se,s'
		}).disableSelection();
		$(this).find('.edite > .label').text($(this).index()+1);
	});

	$('#'+ele+' > li > img').attr("id", function (arr) { return "il" + (arr+1);});
		
	addimageLayoutDelEvent(ele);
	initImageLayoutSelect();
}

function initImageLayoutSelect() {
	
	var cnt = $('#imgLayout').children().length;
	var html = "<option value=\"-1\">-이미지 등록-</option>";
	for (var i = 0; i < cnt ;i++ ){
		html += "<option value=\""+(i+1)+"\">"+(i+1)+" 번</option>";
	}

	$("#imgLayout_no").html(html);
}

function setImageLayoutUpload() {

	var index = document.getElementById("imgLayout_no").value;
	var width = 100;
	if (index >= 0){
		width = $('#imgLayout').children().eq(index-1).width();
		$('#imgLayout_upload').uploadify( uplodify_one('uploadify.jsp', 'il'+index, {'width' : width} ) );//#imgOne_upload
		alert( $('#il'+index) );
		$('#imgLayout_upload').show();
	}else {
		$('#imgLayout_upload').hide();
	}
}

function removeImageLayoutAppend(ele) {

	var t = $('#'+ele);
	t.html("");
	reloadImageLayout(ele);
}



function de(msg) {
    $('#debug').val($('#debug').val()+"\r\n"+msg);
}
	</script>


  	<h1>속성</h1>
  	<dl>
  		<dt>이미지 1장</dt>
  		<dd>
  			<div id="imgOne_wrap">
  				<div id="imgOne_box"><img id="imgOne" src="" /></div>
  				<input type="file" name="imgOne_upload" id="imgOne_upload" />
  			</div>
  		</dd>
  		<dt>이미지 썸네일</dt>
  		<dd>
  			<div id="imgThumbnail_wrap">
  				<ul id="imgThumbnail_box"></ul>
  				<input type="file" name="imgThumbnail_upload" id="imgThumbnail_upload" />
  				<a href="#" onclick="$('#imgThumbnail_box').thumbNail('RemoveAllData');">모두삭제</a>
                <a href="#" onclick="thumbSortAble(true)">이동모드</a>
                <a href="#" onclick="thumbSortAble(false)">이동해제</a>
  			</div>
  		</dd>
        <dt>이미지 슬라이드</dt>
  		<dd>
  			<div id="imgSlide_wrap">
  				<div id="imgSlide_box"></div>
                <div id="imgSlide_move_box"></div>
  				<input type="file" name="imgSlide_upload" id="imgSlide_upload" />
  				<a href="#" onclick="slideDataRemoveAll('imgSlide_box')">모두삭제</a>
                <a href="#" onclick="slideSortAble(true, 'imgSlide')">이동모드</a>
                <a href="#" onclick="slideSortAble(false, 'imgSlide')">이동해제</a>
  			</div>
  		</dd>
        <dt>분할 이미지</dt>
  		<dd>
			<div id="imgLayout_wrap">
				<ul id="imgLayout"></ul>
				<select name="imgLayout_no" id="imgLayout_no" onchange="setImageLayoutUpload()"><option value="-1">-이미지 등록-</option><option value="1">1 번</option><option value="2">2 번</option><option value="3">3 번</option><option value="4">4 번</option></select>
				<input type="file" name="imgLayout_upload" id="imgLayout_upload" style="display:none"/>
				<a href="#" onclick="addImageLayoutAppend('imgLayout', 1)">추가</a>
                <a href="#" onclick="removeImageLayoutAppend('imgLayout')">모두삭제</a>
			</div>
  		</dd>
		
  	</dl>

	<dl>
		<dt>동영상 1개</dt>
  		<dd>
  			<div id="movieOne_wrap">
  				<div id="movieOne_box"><img id="movieOne" src="" /><img class="play_icon" src="_images/Play.png"></div>
  				<input type="file" name="movieOne_upload" id="movieOne_upload" />
				<input type="text" name="movieOneLink" value="http://"/>
  			</div>
  		</dd>
		<dt>동영상 슬라이드</dt>
  		<dd>
  			<div id="movieSlide_wrap">
  				<div id="movieSlide_box"></div>
                <div id="movieSlide_move_box"></div>
  				<input type="file" name="movieSlide_upload" id="movieSlide_upload" />
  				<a href="#" onclick="slideDataRemoveAll('movieSlide_box')">모두삭제</a>
                <a href="#" onclick="slideSortAble(true, 'movieSlide')">이동모드</a>
                <a href="#" onclick="slideSortAble(false, 'movieSlide')">이동해제</a>
  			</div>
  		</dd>
	</dl>

  </body>
</html>