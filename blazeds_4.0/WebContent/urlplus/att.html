<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7"/>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="Content-Script-Type" content="text/javascript" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<title>URLPlus</title>
    <link rel="stylesheet" type="text/css" href="css/base.css" />
    <link rel="stylesheet" type="text/css" href="css/att.css" />
    <link rel="stylesheet" type="text/css" href="css/uploadify.css" />
    <script type="text/javascript" src="js/jquery-1.8.1.min.js"></script>
	<script type="text/javascript" src="js/jquery.uploadify-3.1.min.js"></script>
	<script type="text/javascript" src="js/jquery-ui-1.9.1.custom.min.js"></script>
    <script type="text/javascript" src="js/galleria/galleria-1.2.8.min.js"></script>
   </head>
  <body>

	<script type="text/javascript">
	$(document).ready(function(){

        $('#imgOne_upload').uploadify({
			'swf'      : 'js/uploadify.swf', // 파일업로드 이벤트 가로채틑 flash
			'uploader' : 'uploadify.jsp', // 비동기 업로드시 처리 url
			'fileTypeDesc' : 'Image Files',
	        'fileTypeExts' : '*.gif; *.jpg; *.png',
			'buttonText' : '이미지등록',
			'removeTimeout' : 1, // queue 제거 시간
			'multi' : false, // 다중업로드
 			'onUploadSuccess' : function(file, data, response) {
 				
 				$('#debug').val($('#debug').val()+"\r\n"+file+"/"+data+"/"+response);
 				var rslt;
 				try {
 					rslt = jQuery.parseJSON(data);
 					if (rslt.b == "true") {
 	 	 				if ($('#imgOne').length > 0) $('#imgOne').attr('src','/urlImage/'+rslt.img);
 	 	 				else $('#imgOne_box').append('<img id="imgOne" src="'+"/urlImage/"+rslt.img+'" />');
 					} else {
 						alert("에러 : "+rslt.err);
 					}
 	 				
 				}catch(err){ alert("업로드 실패");}
        	}
 			
		});//#imgOne_upload
		
		
		$('#imgThumbnail_upload').uploadify({
			'swf'      		: 'js/uploadify.swf', 	// 파일업로드 이벤트 가로채틑 flash
			'uploader' 		: 'uploadifyMulti.jsp', // 비동기 업로드시 처리 url
			'fileTypeDesc'	: 'Image Files',
	        'fileTypeExts'	: '*.gif; *.jpg; *.png',
			'buttonText'	: '이미지등록',
			'removeTimeout' : 1, 					// queue 제거 시간
			'multi' 		: true, 				// 다중업로드
 			'onUploadSuccess' : function(file, data, response) {
 				
 				$('#debug').val($('#debug').val()+"\r\n"+file+"/"+data+"/"+response);
 				var rslt;
 				try {
 					rslt = $.parseJSON(data);
 					
 					if (rslt.b == "true") {
                        thumbData.push({image: '/urlImage/'+rslt.img,
                                                thumb: '/urlImage/thumb/'+rslt.img });
                    }
 					else
 						alert("에러 : "+rslt.err);
 	 				
 				}catch(err){ alert("업로드 실패"); }
 				
        	},
        	
        	'onQueueComplete' : function(queueData) {
        		thumbEditView();
                alert("총 " + $("#imgThumbnail_box").children().length + " 개의 이미지가 업로드 되어 있습니다.");
            }
 			
		});//#imgThumbnail_upload

        $('#imgSlide_upload').uploadify({
			'swf'      		: 'js/uploadify.swf', 	// 파일업로드 이벤트 가로채틑 flash
			'uploader' 		: 'uploadifySlide.jsp', // 비동기 업로드시 처리 url
			'fileTypeDesc'	: 'Image Files',
	        'fileTypeExts'	: '*.gif; *.jpg; *.png',
			'buttonText'	: '이미지등록',
			'removeTimeout' : 1, 					// queue 제거 시간
			'multi' 		: true, 				// 다중업로드
 			'onUploadSuccess' : function(file, data, response) {
 				
 				$('#debug').val($('#debug').val()+"\r\n"+file+"/"+data+"/"+response);
 				var rslt;
 				try {
 					rslt = $.parseJSON(data);
 					if (rslt.b == "true") {
                        slideData.push({image: '/urlImage/'+rslt.img,
                                                thumb: '/urlImage/thumb/'+rslt.img,
                                                big: '/urlImage/'+rslt.img,
                                                link: '#' });
                    }
 					else
 						alert("에러 : "+rslt.err);
 	 				
 				}catch(err){ alert("업로드 실패"+err); }
 				
        	},
        	
        	'onQueueComplete' : function(queueData) {
               
                if (!bSlideRun) slideInitGalleria();
                slideView();
                alert("총 " + slideData.length + " 개의 이미지가 업로드 되어 있습니다.");
               //slideData = [];
            }
 			
		});//#imgSlide_upload
        
    }) // $(document).ready
	
    var thumbData = []; // thumb data
    
    /**
    * view -> remove UI -> remove Event
    */
    function thumbEditView() {
        thumbView();
        thumbRemoveView();
        thumbRemoveEvent();
    }
    /**
    * thumb view by thumbData
    */
    function thumbView() {
        
        $('#imgThumbnail_box').empty();
        var html = "";
        var cnt = thumbData.length;
        var obj = null;
        for ( var i = 0; i < cnt ; i++ ) {
            obj = thumbData[i];
            html += '<li><img src="'+obj.thumb+'" /></li>';
        }
        $('#imgThumbnail_box').html(html);
    }

    /**
    * thumb remove image view
    */
    function thumbRemoveView() {
        
        var left = $('#imgThumbnail_box > li').width() - 18;
        $('#imgThumbnail_box > li').append('<img src="_images/img_del.gif" width="18" height="18" class="imgdel" style="left:'+left+'px;" alt="삭제" />');
    }

    /**
    * thumb add remove event
    */
    function thumbRemoveEvent() {

        $("#imgThumbnail_box > li > img").click(function(){
            var index = $(this).parent().prevAll().length;
            thumbData.splice( index, 1 ); 
            thumbEditView();
        });
    }
    /**
    * thumb all remove click handler
    */
	function thumbDataRemoveAll() {
		$("#imgThumbnail_box > li").remove();
        thumbData.splice( 0, thumbData.length);
        thumbEditView();
		return false;
	}
	
    /**
    * thumbnail drag & drop enable
    */
    var start_pos = 0;
    var end_pos = 0;
	function thumbSortAble(b) {
        if (b) {
            $('#imgThumbnail_box').sortable({
                cursor: "move",
                start: function(event, ui) {
                    var sp = ui.item.index();
                    ui.item.data('start_pos', sp);
                },
                change: function(event, ui) {
                    start_pos = ui.item.data('start_pos');
                    end_pos = ui.placeholder.index();
                   
                    if (start_pos < end_pos) end_pos -= 1;
                     de(start_pos+"=>"+end_pos);

                },
                update: function(event, ui) {
                    de("end!! : "+start_pos+"=>"+end_pos);
                    thumbData.move( start_pos, end_pos);
                }
            });

            $("#imgThumbnail_box").disableSelection();

            $('#imgThumbnail_box > li > img.imgdel').hide();
            alert("이미지를 드래그 하여 순서를 변경하세요.");
        } else {
            $( "#imgThumbnail_box" ).sortable( "destroy" );
            thumbEditView();
            $('#imgThumbnail_box > li > img.imgdel').show();
            alert("이동모드가 해제 되었습니다.");
        }
    }

    Array.prototype.move = function (old_index, new_index) {
        while (old_index < 0) {
            old_index += this.length;
        }
        while (new_index < 0) {
            new_index += this.length;
        }
        if (new_index >= this.length) {
            var k = new_index - this.length;
            while ((k--) + 1) {
                this.push(undefined);
            }
        }
        this.splice(new_index, 0, this.splice(old_index, 1)[0]);
        return this;
    };

    var slideData = []; // slide data
    var bSlideRun = false;
    /**
    * slide init
    */
    function slideInitGalleria() { 

        Galleria.loadTheme('js/galleria/galleria.classic.min.js');
        Galleria.ready(function() {

            //add delete image to thumbnail 
            this.bind("thumbnail", function(e) {
                var left = $(e.thumbTarget).width() - 18;
                $(e.thumbTarget).after('<img src="_images/img_del.gif" width="18" height="18"  class="imgdel" style="left:'+left+'px;" onclick="slideDataRemove('+e.index +')" alt="삭제"/>'); // delete button
            });

            // add delete image to image
            this.bind('image', function(e) {

                var left = $(e.imageTarget ).parent().width() - 18;
                $(e.imageTarget ).after('<img src="_images/img_del.gif" width="18" height="18" style="position:absolute;top:0px;left:'+left+'px;" onclick="slideDataRemove('+e.index +')" alt="삭제"/>'); // delete button
            });

        });
        
        Galleria.run('#imgSlide_box', {height:320}); // ,dataSource: slideData
        bSlideRun = true;
    }
    /**
    * slide view by slideData
    */
    function slideView() {
        var gallery = Galleria.get(0);
        $('#imgSlide_box').show();
        gallery.setOptions('dataSource', slideData);
        gallery.load();
    }
    
    /**
    * slide remove click handler
    */
    function slideDataRemove(index) {
        var gallery = Galleria.get(0); 
        gallery.splice( index, 1 ); 
        gallery.load();
        if (gallery.getDataLength() <= 0)
            $('#imgSlide_box').hide();
    }
	
    /**
    * slide all remove click handler
    */
    function slideDataRemoveAll() {
        slideData = [];
        var gallery = Galleria.get(0);
        gallery.setOptions('dataSource', slideData);
        gallery.load();
        $('#imgSlide_box').hide();
    }
    /**
    * slide drag & drop enable
    */
    var start_slide_pos = 0;
    var end_slide_pos = 0;
	function slideSortAble(b) {
        if (b) {
            $("#imgSlide_box").hide();
            $("#imgSlide_move_box").show();

            slideMoveView();

            $('#imgSlide_move_box').sortable({
                cursor: "move",
                start: function(event, ui) {
                    var sp = ui.item.index();
                    ui.item.data('start_pos', sp);
                },
                change: function(event, ui) {
                    start_slide_pos = ui.item.data('start_pos');
                    end_slide_pos = ui.placeholder.index();
                   
                    if (start_slide_pos < end_slide_pos) end_slide_pos -= 1;
                     de(start_slide_pos+"=>"+end_slide_pos);

                },
                update: function(event, ui) {
                    de("end!! : "+start_slide_pos+"=>"+end_slide_pos);
                    slideData.move( start_slide_pos, end_slide_pos);
                }
            });
            $("#imgSlide_move_box").disableSelection();
            alert("이미지를 드래그 하여 순서를 변경하세요.");

        } else {
            $("#imgSlide_move_box").sortable( "destroy" );
            $("#imgSlide_move_box").hide();

            $("#imgSlide_box").show();
            slideView();
            alert("이동모드가 해제 되었습니다.");
        }
    }

    function slideMoveView() {

        $('#imgSlide_move_box').empty();
        var html = "";
        var cnt = slideData.length;
        var obj = null;
        for ( var i = 0; i < cnt ; i++ ) {
            obj = slideData[i];
            html += '<li><img src="'+obj.thumb+'" /></li>';
        }
        $('#imgSlide_move_box').html(html);
    }

    
    function de(msg) {
        $('#debug').val($('#debug').val()+"\r\n"+msg);
    }


(function($) {
	/* global */
	var thubmOpt = {thumbData:[]};
	function al() {alert(1111);}
	// public
	var methods = {
		init: function (options) {
			this.each(
				function () {
					$.extend(thumbOpt, options); // option setting
				} // function
			);// each

		return this;
	},
		init: function (options) {}
	};
	$.fn.thumbNail = function (action) {
		if (methods[action])
			return methods[action].apply(this, Array.prototype.slice.call(arguments, 1));
		else
			return methods.init.apply(this, arguments);
	};// fn.thumbNail

})(jQuery);

	</script>

<button onclick="al()">dafdasf</button>
  	<h1>속성</h1>
  	<dl>
  		<dt>이미지 1장</dt>
  		<dd>
  			<div id="imgOne_wrap">
  				<div id="imgOne_box"></div>
  				<input type="file" name="imgOne_upload" id="imgOne_upload" />
  			</div>
  		</dd>
  		<dt>이미지 썸네일</dt>
  		<dd>
  			<div id="imgThumbnail_wrap">
  				<ul id="imgThumbnail_box"></ul>
  				<input type="file" name="imgThumbnail_upload" id="imgThumbnail_upload" />
  				<a href="#" onclick="thumbDataRemoveAll()">모두삭제</a>
                <a href="#" onclick="thumbSortAble(true)">이동모드</a>
                <a href="#" onclick="thumbSortAble(false)">이동해제</a>
  			</div>
  		</dd>
        <dt>이미지 슬라이드</dt>
  		<dd>
  			<div id="imgSlide_wrap">
  				<div id="imgSlide_box"></div>
                <div id="imgSlide_move_box"></div>
  				<input type="file" name="imgSlide_upload" id="imgSlide_upload" />
  				<a href="#" onclick="slideDataRemoveAll()">모두삭제</a>
                <a href="#" onclick="slideSortAble(true)">이동모드</a>
                <a href="#" onclick="slideSortAble(false)">이동해제</a>
  			</div>
  		</dd>
  	</dl>
  	<textarea id="debug" rows="40" cols="100" style="position:absolute;left:500px;top:10px;"></textarea>
  </body>
</html>

